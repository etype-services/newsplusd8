<?php

use Drupal\etype_pico\Controller\EtypePicoEeditionController;
use Drupal\node\NodeInterface;
use Drupal\taxonomy\Entity\Term;
use Drupal\Core\Url;


/**
 * Preprocess Nodes.
 *
 * @param $variables
 */
function etype_pico_preprocess_node(&$variables) {
  $config = Drupal::config('etype_pico.settings');
  $picoPublisherId = $config->get('picoPublisherId');
  if (!empty($picoPublisherId)) {
    $variables['picoEnabled'] = TRUE;
  }
}

/**
 * Implements hook_page_attachments().
 *
 * @param array $page
 * @throws \SoapFault
 */

function etype_pico_page_attachments(array &$page) {
  $current_url = Url::fromRoute('<current>');
  $path = $current_url->toString();
  if ($path == '/e-edition') {
    $url = (new EtypePicoEeditionController)->getEeditionUrl();
    $page['#attached']['drupalSettings']['toknizdUrl'] = $url;
    $page['#attached']['library'][] = 'etype_pico/pico-auth';
  }
  $page['#attached']['library'][] = 'etype_pico/pico';
}
